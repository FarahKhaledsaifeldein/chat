<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CostChat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #f5f5f5; }
        .sidebar { width: 260px; height: 100vh; position: fixed; background: #202123; color: white; padding: 20px; overflow-y: auto; }
        .sidebar h4 { margin-bottom: 20px; font-size: 1.2em; }
        .sidebar ul { list-style: none; padding: 0; }
        .sidebar ul li { padding: 10px; cursor: pointer; border-radius: 5px; }
        .sidebar ul li:hover { background: #2c2c2c; }
        .sidebar ul li.active { background: #343541; }
        .chat-area { margin-left: 260px; padding: 20px; height: 100vh; overflow-y: auto; background: white; }
        .message { margin-bottom: 15px; padding: 10px; border-radius: 5px; max-width: 70%; }
        .message.user { background: #10a37f; color: white; margin-left: auto; }
        .message.bot { background: #444654; color: white; }
        input { width: 70%; margin-right: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; background: #10a37f; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0c8a6a; }
        .new-project-form { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h4>Chats</h4>
        <ul>
            {% for project in projects %}
                <li class="{% if project.id == project.id %}active{% endif %}" 
                    onclick="window.location.href='{% url 'chat' %}?project_id={{ project.id }}'">
                    {{ project.name }}
                </li>
            {% endfor %}
        </ul>
    </div>
    <div class="chat-area">
        <h2>{{ project.name }}</h2>
        <div id="chat-log" style="height: 70vh; overflow-y: auto;">
            {% for message in messages %}
                <div class="message {{ message.sender }}">
                    {{ message.content }}
                </div>
            {% endfor %}
        </div>
        <div class="new-project-form">
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn btn-primary">Create New Project</button>
            </form>
        </div>
        <input id="chat-message-input" type="text" placeholder="Type a message...">
        <button id="chat-message-submit">Send</button>
    </div>

    <script>
        const chatSocket = new WebSocket(`ws://${window.location.host}/ws/chat/`);

        chatSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            document.querySelector('#chat-log').innerHTML += `<div class="message bot">${data.message}</div>`;
            document.querySelector('#chat-log').scrollTop = document.querySelector('#chat-log').scrollHeight;
        };

        document.querySelector('#chat-message-submit').onclick = function(e) {
            const messageInput = document.querySelector('#chat-message-input');
            const message = messageInput.value;
            chatSocket.send(JSON.stringify({'message': message}));
            document.querySelector('#chat-log').innerHTML += `<div class="message user">${message}</div>`;
            messageInput.value = '';
            document.querySelector('#chat-log').scrollTop = document.querySelector('#chat-log').scrollHeight;
        };
    </script>
</body>
</html>